# Утилита План

Утилита, предназначенная для разработчиков и лидов для анализа и декомпозиции задачи, оценки её сложности и построения документа с планом работ и ходом выполнения.

## Концепция

### Проблема

80% задач выполняется с опозданием (какое-то исследование).

Некоторые причины:
* Недостаточно хороший анализ задачи, как следствие неучтённые детали и непредвиденные сложности.
* Оценка задачи "на глаз" - ошибочная, мы часто переоцениваем себя и недооцениваем задачу.

### Решение

Анализ. Перед началом кодинга, получить документ, составление которого требовало-бы провести глубокий анализ задачи. То есть исследовательскую часть задачи сдвинуть вперед по времени, а сам кодинг сдвинуть назад, убрав чередование анализ-кодинг-анализ-кодинг-... , оставив один цикл анализ-кодинг.

Оценка. Человек плохо оценивает сложные вещи, точнее оценивает простые. Не оценивать задачу целиком, а разбить на маленькие кусочки, которые можно оценить "на глаз" более-менее точно. Сумму маленьких оценок сложить и получить общий результат.

### Реализация

Читаем постановку задачи, думаем как будем решать, затем идём в проект и ищем те места в коде, которые предстоит изменить. С помощью специального вида TODO-комментариев отмечаем места в коде, которые предстоит изменить. Каждому такому изменению указываем параметры: небольшое текстовое описание, оценку в часах, и ряд других. Запускаем утилиту, которая сканирует файлы, собирает комментарии и из них строит документ и считает оценку.

Есть два варианта утилиты: для простых задач и сложных. Для простых задач меньше дополнительных параметров, для больших - больше. Ниже об этом будет подробнее.

В дальнейшем простая утилита будет именоваться как __plan-plain__, а сложная - __plan-graph__.

## [plan-plain](readme-plain.md)

Простой плоский план, подходит для совсем простых задач.

Пример комментария:

```
TODO: PL: Добавить поля в модель Post 0.5/0/10
```

Пояснение:

```
TODO: PL:    Добавить поля в модель Post           0.5/0/10
___________  ____________________________________  ________________________________________
Маркер       Описание                              Время/готовность/положение в документе
```

Отметив в коде места, подлежащие изменению, запускаем утилиту. Она соберет эти комментарии вместе, сформирует документ и выполнит подсчет времени и готовность задачи.

__Пример документа__

> __План задачи 1892-add-read-time-and-word-count__
>
> **Время: 8.0 ч.**
> **Готовность: 19 %**
> * ~~Создать миграцию, добавляющую счетчик слов и прочтений~~
>   <sup>bloggitt/core/migrations/0005_auto_20201206_1112.py</sup>
>   <sup>Время: 0.5 ч. Готовность: 100%</sup>
> * __Добавить поля в модель Post, сделать обновление счетчиков при сохранении контента__
>   <sup>bloggitt/core/models.py</sup>
>   <sup>Время: 1 ч. Готовность: 50%</sup>
> * __В утилиты добавить методы для подсчета слов в тексте и время на чтение__
>   <sup>bloggitt/core/utils.py</sup>
>   <sup>Время: 1 ч. Готовность: 50%</sup>
> * Во вью (контроллер) добавить код увеличивающий счетчик просмотров поста
>   <sup>bloggitt/core/views.py</sup>
>   <sup>Время: 0.5 ч. Готовность: 0%</sup>
> * Вывести время чтения и кол-во просмотров
>   <sup>bloggitt/templates/detail.html</sup>
>   <sup>Время: 1 ч. Готовность: 0%</sup>
> * Написать тесты
>   <sup>bloggitt/tests/tests.txt</sup>
>   <sup>Время: 2 ч. Готовность: 0%</sup>

В документе перечислены комментарии, соответствующие маркеру `TODO: PL:`. Время, готовность и положение (порядок сортировки) в документе берутся из второй части комментария `0.5/0/10`, имя файла - из имени файла, в котором расположен комментарий.

Такого рода простой план хорошо подходит для небольших задач. Может использоваться, на пример, как руководство, для джуна от разработчика постарше. То есть, план сформировал старший разработчик, коротко указал что и где делать, и отдал для выполнения младшему разработчику. Далее джун с помощью документа информирует о ходе работы.

Процесс может выглядеть так (но не обязательно именно так): синьор создал тематическую ветку, проанализировал задачу, прописал комментарии, передал ветку джуну. Джун с помощью IDE видит TODO, по ним ориентируется, что где делать. По мере продвижения работы джун меняет у комментариев прогресс выполнения и информирует старшего разработчика о ходе работы с помощью документа.

[Подробное описание plan-plain](readme-plain.md)

## [plan-graph](plan-graph.md)

__plain-plan__ - прост и наивен и не очень хорошо подходит для сложных задач.

Для крупных задач важно не только найти места для изменения, но и выявить зависимости между ними. При построении зависимостей между частями задачи выявляются неучтенные места о которых сразу и не подумалось. Так задача лучше прорабатывается на раннем этапе и на пути к решению будет меньше сюрпризов.

__plan-graph__ позволяет не только строить документ, но и графическую диаграмму, которая наглядно представляет план работы (который вовсе не линеен). Эта диаграмма позволяет визуально оценить зависимости между частями, оценить качество проработки, выстроить последовательность работ и контролировать их ход, в том числе для себя лично. Когда задача большая, бывает уже и сам забыл что сделано, а что еще надо доделать.

Пример диаграммы (кликабельно):

![Diagram](img/plangraph1.png)

Для анализа, построения диаграммы и документа требуются комментарии такого вида:

```
# TODO: PL: Добавить UserForm и ProfileForm
# ID: bloggitt/core/forms.py:13
# DEP: bloggitt/core/models.py:10
# DEP: bloggitt/bloggitt/settings.py:33
# TIME: 0.25
# COMPL: 50
```

Тут:

* `TODO: PL: Добавить UserForm и ProfileForm` маркер и описание
* `ID: bloggitt/core/forms.py:13` уникальный ID комментария (произвольная строка)
* `DEP: bloggitt/core/models.py:10` ID другого комментария. От которого завист данный блок работ
* `TIME: 0.25` Оценка времени в часах
* `COMPL: 50` Оценка готовности в процентах

[Подробное описание plan-graph](readme-graph.md)

## Установка

```
git clone https://github.com/stg34/wp.git
```

### Зависимости

Для работы требуется установленный __git__.

Для утилиты __plan-graph__ требуется установленный [graphviz](https://graphviz.org/download/) (нужен для построения диаграммы)


## Запуск

В __директории с рабочим проектом__, в которой исходники с комментариями:

```
> python3 /path/to/wp/planplain.py -b master # для простого плана
> python3 /path/to/wp/plangraph.py -b master # для сложного плана
```

Параметр `-b [имя базовой ветви git]` обязательный. Это имя ветки, куда будет в конце влита задача. Чаще всего __master__ или __main__, но может зависеть от принятых правил разработки.
Утилита ищет комментарии только в тех файлах, которые изменены по сравнению с базовой. Например, если тематическая ветка была отпочковона от __master__, то и указывать надо __master__

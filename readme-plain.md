# Утилита План

## Концепция

Необходимо сделать оценку задачи по времени (сложности).

1. Читаем постановку задачу
2. Идём в код и ищем те места, которые предстоит изменить в рамках задачи. Небольшими TODO комментариями, в определенном формате, отмечаем эти места.
3. Запускаем утилиту - получаем документ, содержащий информацию о том в каких местах что надо изменить, затраты на каждое изменение и суммарную оценку.

__Пример комментария__

```
TODO: PL: Добавить поля в модель Post 0.5/0/10
_________ ___________________________ ________________________________________
Маркер    описание                    время/готовность/положение в документе
```

В результате:
1. Повышается осведомленность о задаче
2. Просматривается код, подлежащий изменеию
3. Выявляются проблемы, о которых сразу и не подумалось
4. Появляется документ с планом работ и отметками о ходе выполнения, который легко поддерживать и обновлять

__Пример документа__

> ### План задачи 1892-add-read-time-and-word-count
>
> **Время: 8.0 ч.**
> **Готовность: 19 %**
> * ~~Создать миграцию, добавляющую счетчик слов и прочтений~~
>   <sup>bloggitt/core/migrations/0005_auto_20201206_1112.py</sup>
>   <sup>Время: 0.5 ч. Готовность: 100%</sup>
> * __Добавить поля в модель Post, сделать обновление счетчиков при сохранении контента__
>   <sup>bloggitt/core/models.py</sup>
>   <sup>Время: 1.0 ч. Готовность: 50%</sup>
> * __В утилиты добавить методы для подсчета слов в тексте и время на чтение__
>   <sup>bloggitt/core/utils.py</sup>
>   <sup>Время: 1.0 ч. Готовность: 50%</sup>
> * Во вью (контроллер) добавить код увеличивающий счетчик просмотров поста
>   <sup>bloggitt/core/views.py</sup>
>   <sup>Время: 0.5 ч. Готовность: 0%</sup>
> * Вывести время чтения и кол-во просмотров
>   <sup>bloggitt/templates/detail.html</sup>
>   <sup>Время: 1.0 ч. Готовность: 0%</sup>
> * Написать тесты
>   <sup>bloggitt/tests/tests.txt</sup>
>   <sup>Время: 4.0 ч. Готовность: 0%</sup>

Пункты, имеющие готовность 100% зачеркиваются, пункты с готовностью больше 0%, но меньше 100% выделяются жирным (то над чем работаем сейчас), пункты с готовностью 0% особо не выделяются.

Последовательность пунктов в документе определяется в соответствии с параметром "порядок" в комментариии. Чтоб было проще расставить пункты в документе можно использовать параметр --verbose, который добавит в документ информацию о заданном порядке.

> # План задачи TASK-1234
>
> **Время: 8.0 ч.**
> **Готовность: 19 %**
> * ~~Создать миграцию, добавляющую счетчик слов и прочтений~~
>   <sup>bloggitt/core/migrations/0005_auto_20201206_1112.py</sup>
>   <sup>Время: 0.5 ч. Готовность: 100%</sup>
>   <sub><sup>    Определено: bloggitt/core/migrations/0005_auto_20201206_1112.py:3    __Порядок: 10__<br>  </sup></sub>
> * __Добавить поля в модель Post, сделать обновление счетчиков при сохранении контента__
>   <sup>bloggitt/core/models.py</sup>
>   <sup>Время: 1.0 ч. Готовность: 50%</sup>
>   <sub><sup>    Определено: bloggitt/core/models.py:34    __Порядок: 20__<br>  </sup></sub>

## Установка

```
git clone https://github.com/stg34/wp.git
```

## Запуск

В директории с рабочим проектом, в которой исходники с комментариями:

```
> python3 ~/path/to/wp/plan_plain.py
```

### Параметры коммандной строки

```
-b branch-name
--base-branch branch-name
```

Комментарии ищутся не во всех файлах проекта, а в тех, что изменены, по сравнению с базовой веткой (чаще всего master или main). Этот параметр определяет имя базовой ветки git.
По умолчанию __master__

```
-o out-file.md
--output out-file.md
```

Имя файла для сгенерированного документа.
По умолчанию __plan.md__

```
-t title
--title title
```

Название задачи в документе.
По умолчанию __имя текущей ветки git__

```
-s scale
--scale scale
```

Число, на которое будет умножено время или SP при генерации документа. Например если в комментарии указано ожидаемое время 2 часа, а scale=2.5, то в документе будет указано 5 часов.
По умолчанию __1__

```
-f PL
--todo-suffix PL
```

Маркер для TODO. По умолчанию ищутся комментарии вида: TODO: PL: .....
При необходиости PL можно переопределить, например для --todo-suffix PLAN комментаии будут вида: TODO: PLAN: .....
По умолчанию __PL__


```
-w hours
--work-hours hours
```

Кол-во часов в день, котрое предполагается тратить на задачу. Влияет на подсчет кол-ва дней на задачу. Если не задано, то подсчет дней не производится.

Например для --work-hours 4 в документ будет выглядет так

> ### План задачи 1892-add-read-time-and-word-count
>
> **Время: 8.0 ч. (2 д. 0 ч.)**
> **Готовность: 19 %**
> ..............

По умолчанию __не задано__

```
-v
--verbose
```

Если указан параметр то:
1. В консоль выводится дополнительная информация, в частности перечень файлов в которых будет произведен поиск комментариев.
2. В документ будут добавлены строки с указанием файла и номера строки, где определен комментарий, а также какой задан ему порядок. Это помогает расставить пункты в документе в нужной последовательности.

По умолчанию __не задано__

### Конфигурационный файл

Что бы каждый раз не указывать опции коммандной строки, в директорию с проектом можно попложить файл __.planplain.conf__, в котором указать те же опции:

```
[MAIN]
base-branch = main
title = TASK-1234
scale = 1
todo-suffix = PL
work-hours = 4
verbose = 0
```
## Советы по использованию

Для ускорения ввода можно использовать шаблоны, которые поддерживаются всеми основными IDE.

![Template](img/plan.gif)

Для навигации удобно использовать встроенные или установленные как дополнение в IDE списки  TODO с фильтрацией по маркеру PL

![TODO](img/todo.png)

Если в IDE Idea запустить утилиту во встроенном терминале, то можно легко перемещаться по TODO с помощью вывода утилиты в консоль

![Terminal](img/terminal.png)
